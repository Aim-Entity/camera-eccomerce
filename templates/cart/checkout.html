{% extends 'base.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
   {% block header %}
   <script src="{% static 'cart/checkout.js' %}" defer></script>
   <title>Photogen - Checkout</title>
   {% endblock %}
</head>
<body>
   {% block content %}
   <div class="cont-f">
      <main>
         <div class="section-2f">
            <div class="checkout-title">
               <h1>Checkout</h1>
            </div>
            <div class="checkout-title-sep"></div>
            <div class="checkout-m">
               <div class="checkout-right">
                  <div class="checkout-recap-title">
                     <h1>Order Summary</h1>
                     <h3 class="checkout-id">ID: 258751689</h3>
                     <div class="checkout-right-sep1"></div>
                  </div>
                  <div class="checkout-summary-items">
                     <img src="{% static 'imgs/Png/camera-product-min.png' %}" alt="a camera" class="checkout-img">
                     <h2>Name</h2>
                     <h3>$69.99</h3>
                  </div>
                  <div class="checkout-right-sep2"></div>
                  <div class="checkout-summary-items">
                     <img src="{% static 'imgs/Png/camera-product-min.png' %}" alt="a camera" class="checkout-img">
                     <h2>Name</h2>
                     <h3>$69.99</h3>
                  </div>
                  <div class="checkout-right-sep2"></div>
                  <div class="checkout-price">
                     <h2 class="checkout-total">Items: 1</h2>
                     <h2 class="checkout-total-price">Total $99.99</h2>
                  </div>
               </div>
               <div class="checkout-left">
                  <div class="checkout-input">
                     <h1>Shipping info</h1>
                     <input type="text" name="address 1" id="checkout-address1" placeholder="Address Line" required>
                     <div class="checkout-city">
                        <input type="text" name="state" id="checkout-state" placeholder="State" required>
                        <input type="text" name="city" id="checkout-city" placeholder="City" required>
                     </div>
                     <div class="checkout-zip">
                        <input type="number" name="zip" id="checkout-zip" placeholder="Zip Code" required>
                        <input type="text" name="country" id="checkout-country" placeholder="Country" required>
                     </div>
                     <button type="submit" class="checkout-button">Continue</button>
                  </div>
               </div>
            </div>
            <div class="checkout-d">
               <div class="checkout-left">
                  <div class="checkout-input">
                     <h1>Shipping info</h1>
                     <input type="text" name="address 1" id="checkout-address1" placeholder="Address Line" required>
                     <div class="checkout-city">
                        <input type="text" name="state" id="checkout-state" placeholder="State" required>
                        <input type="text" name="city" id="checkout-city" placeholder="City" required>
                     </div>
                     <div class="checkout-zip">
                        <input type="number" name="zip" id="checkout-zip" placeholder="Zip Code" required>
                        <input type="text" name="country" id="checkout-country" placeholder="Country" required>
                     </div>
                     <button type="submit" class="checkout-button">Continue</button>
                  </div>
               </div>
               <div class="checkout-right">
                  <div class="checkout-recap-title">
                     <h1>Order Summary</h1>
                     <h3 class="checkout-id">ID: 258751689</h3>
                     <div class="checkout-right-sep1"></div>
                  </div>
                  <div class="checkout-summary-items">
                     <img src="{% static 'imgs/Png/camera-product-min.png' %}" alt="a camera" class="checkout-img">
                     <h2>Name</h2>
                     <h3>$69.99</h3>
                  </div>
                  <div class="checkout-right-sep2"></div>
                  <div class="checkout-summary-items">
                     <img src="{% static 'imgs/Png/camera-product-min.png' %}" alt="a camera" class="checkout-img">
                     <h2>Name</h2>
                     <h3>$69.99</h3>
                  </div>
                  <div class="checkout-right-sep2"></div>
                  <div class="checkout-price">
                     <h2 class="checkout-total">Items: 1</h2>
                     <h2 class="checkout-total-price">Total $99.99</h2>
                  </div>
               </div>
            </div>
         </div>
      </main>
      <footer>
         <div class="section-7f">
            <div class="footer">
               <div class="f-info">
                  <h1 class="f-address">Address: 215, Rough st, ag21 h4g</h1>
                  <h1 class="f-phone">0653 354 6568</h1>
                  <h1 class="f-email">Photogen@gmail.com</h1>
               </div>
               <div class="f-other">
                  <h1 class="f-imgs">Images from Pexel/Unsplashed</h1>
                  <h1 class="f-fonts">Icons from Fontawsome</h1>
                  <h1 class="f-copy">Copyright Â© 2020 Photogen</h1>
               </div>
               <div class="f-socials">
                  <a href="#"><img src="{% static 'imgs/Svg/facebook-brands (1).svg' %}" alt="facebook icon" class="f-fb"></a>
                  <a href="#"><img src="{% static 'imgs/Svg/twitter-brands (1).svg' %}" alt="twitter icon" class="f-twitter"></a>
                  <a href="#"><img src="{% static 'imgs/Svg/instagram-brands (1).svg' %}" alt="instagram icon" class="f-ig"></a>
               </div>
            </div>
         </div>
      </footer>
   </div>

   <script src="https://www.paypal.com/sdk/js?client-id=AX1wZKlVAXYGeK_VZgjoALVHD3_camQcKTXcvkhYGiNpSvkKtc5YItHELUzlOVTo_J5hLwvU4BOF6apt&currency=USD"></script>

	<script>
		var total = '{{order.get_cart_total}}'
		// Render the PayPal button into #paypal-button-container
		paypal.Buttons({

			style: {
				color: "blue",
				shape: "rect"
			},

			// Set up the transaction
			createOrder: function(data, actions) {
					return actions.order.create({
							purchase_units: [{
									amount: {
											value: parseFloat(total).toFixed(2)
									}
							}]
					});
			},

			// Finalize the transaction
			onApprove: function(data, actions) {
					return actions.order.capture().then(function(details) {
							// Show a success message to the buyer
							submitFormData()
					});
			}
		}).render('#paypal-button-container');
	</script>

	<script>
      var shipping = '{{order.shipping}}'
      var total = '{{order.get_cart_total}}'

      if (shipping == 'False'){
         document.getElementById('shipping-info').innerHTML = ''
      }

      if (user != 'AnonymousUser'){
         document.getElementById('user-info').innerHTML = ''
         }

      if (shipping == 'False' && user != 'AnonymousUser'){
         //Hide entire form if user is logged in and shipping is false
            document.getElementById('form-wrapper').classList.add("hidden");
            //Show payment if logged in user wants to buy an item that does not require shipping
               document.getElementById('payment-info').classList.remove("hidden");
      }

      var form = document.getElementById('form')
      form.addEventListener('submit', function(e){
         e.preventDefault()
         console.log('Form Submitted...')
         document.getElementById('form-button').classList.add("hidden");
         document.getElementById('payment-info').classList.remove("hidden");
         })

         /*
         document.getElementById('make-payment').addEventListener('click', function(e){
         submitFormData()
         })
         */

         function submitFormData(){
            console.log('Payment button clicked')

            var userFormData = {
               "name": null,
               "email": null,
               "total": total
            }

            var shippingInfo = {
               "address": null,
               "city": null,
               "state": null,
               "zipcode": null,
            }

            if(shipping != "False"){
               shippingInfo.address = form.address.value
               shippingInfo.city = form.address.value
               shippingInfo.state = form.address.value
               shippingInfo.zipcode = form.address.value
            }

            if(user == "AnonymousUser"){
               userFormData.name = form.address.value
               userFormData.email = form.address.value
            }

            let url = "/process_order/"
            fetch(url, {
               method: "POST",
               headers: {
                  "Content-Type": "application/json",
                  "x-CSRFToken": csrftoken
               },
               body: JSON.stringify({"form": userFormData, "shipping": shippingInfo,})
            })
            .then((response) => response.json())
            .then((data) => {
               console.log("Success", data)
               alert("Transaction Comleted")
               window.location = "{% url 'store' %}"
            })
         }
	</script>
   {% endblock %}
</body>
</html>